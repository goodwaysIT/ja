---
layout: post
title: "Oracle高可用性：単なるバズワードではない"
excerpt: "15年以上の実装経験を持つチームからのOracle HAソリューション（RAC、Data Guard、MAA）の詳細な解説。実世界の洞察、一般的な落とし穴、そして単なるチェックボックスではなく、本当のビジネス継続性を達成する方法。"
date: 2024-05-23 09:05:00 +0800 # Or your actual publication date
categories: [Oracle, 高可用性, ビジネス継続性]
tags: [oracle, data guard, rac, active-active, MAA, RPO, RTO, 災害復旧, ビジネス継続性, データベース HA]
lang: ja
image: /assets/images/posts/oracle-ha-deepdive.jpg # Suggest a relevant image
---


こんにちは、[Goodways](https://www.goodways.co.jp)のITチームです。我々は15年以上にわたり、お客様のような企業が複雑なITインフラストラクチャの世界をナビゲートするお手伝いをしてきました。そして、他のどの要素よりも強く主張しているのが、**ビジネス継続性**です。今日の24時間365日休みなく続くグローバル市場では、"データベースダウンタイム"という言葉は単なる不便ではなく、潜在的な災難です。収益の損失、評判の棒損、顧客の不満など、その代償は非常に大きいものです。

Oracleはその力量に相応しい、データベースを稼働させ、ビジネスを運営するための強力な技術群を提供しています。しかし、私たちが学んだことがあります：これらの技術を展開することは、単にマニュアルに従うだけではありません。あなたの*特定*のビジネスニーズ、実世界で発生する可能性のある問題、そして単に"紙の上でのHA"ではなく、本当に弾力性のあるソリューションを構築することについての深い理解が必要です。

これは別の乾燥したOracle機能の公式的な解説ではありません。代わりに、数え切れない後夜、困難なクライアントシナリオ、そして最終的には成功したHA実装から得た知見を共有したいと思います。RAC、Data Guard、そして包括的なMAA哲学といった大砲について話しますが、それは私たちの現場経験を通したレンズを通してです。私たちの目標？ Oracle HAの謎を解き、あなたのビジネスを本当に保護するシステムを構築する方法をお見せすることです。

### 本題に入る前に: RPO & RTO – HA戦略の二本柱

特定の技術について詳しく説明する前に、よく耳にする2つの略語について簡単に触れておきましょう：

*   **RPO (Recovery Point Objective・目標復旧地点):** これはデータ損失に関するものです。次の質問に答えます：「災害が発生した場合、どれだけのデータ損失を許容できるか？」ゼロデータ損失でしょうか？数秒？数分？1時間？
*   **RTO (Recovery Time Objective・目標復旧時間):** これはダウンタイムに関するものです。「障害発生後、どれだけ早くシステムを復旧させる必要があるか？」秒単位？分単位？時間単位？

これら2つの目標は、あらゆるHA/DR（災害復旧）計画の絶対的な基盤です。これらは選択する技術、セットアップの複雑さ、そして率直に言って、コストを左右します。これらが最初の段階で*すべての*ステークホルダー（IT*と*ビジネス）によって明確に定義され、合意されていなかったために、多くのプロジェクトが失敗するのを私たちは見てきました。

## 基盤：Oracle Real Application Clusters (RAC) – 単なるフェイルオーバー以上のもの

人々が"Oracle高可用性"を考えるとき、Oracle RACはしばしば真っ先に思い浮かぶものです。それには理由があります。その中核では、**Oracle RACは異なるサーバー（ノード）上で実行される複数のOracleデータベースインスタンスが、同じ共有データベースストレージに同時にアクセスすることを可能にします**。

これは、飛行機に複数のエンジンがあるようなものだと考えてください。一つのエンジンが故障しても、他のエンジンが飛行機を飛ばし続けることができます。

### RACが提供するもの：

1.  **インスタンスレベルの高可用性：** これは古典的なRACの利点です。クラスタ内の1つのサーバー（ノード）がハードウェア障害や計画メンテナンスによりダウンした場合、データベースサービスは透過的に生存ノードにフェイルオーバーします。アプリケーションがこれに対応して正しく設定されていれば（SCANリスナー、接続負荷分散、および透過的アプリケーションフェイルオーバー - TAFを使用）、ユーザーは*最小限の*もしくはまったく障害を経験しないはずです。
2.  **スケーラビリティ（HA論論で見落とされがち）：** HAが主な動機である一方、RACは素晴らしいスケーラビリティも提供します。より多くの処理能力が必要ですか？クラスタに別のノードを追加するだけです。この"スケールアウト"機能は、成長するアプリケーションにとって命線となり得ます。
3.  **ローリングパッチ適用とアップグレード：** 注意深い計画を立てれば、RACではパッチを適用したり、マイナーアップグレードを一度に1つのノードで実行したり、全体的なデータベースサービスを利用可能な状態に保つことができます。これにより計画的なダウンタイムが大幅に削減されます。

### 私たちの「現場からの」RAC評価：

*   **インスタンスレベルでの「アクティブ-アクティブ」：** すべてのインスタンスが稼働し、トランザクションを積極的に処理しています。しかし、真のアプリケーションレベルのアクティブ-アクティブを実現するには、アプリケーションがすべてのノード間で作業を分散し、接続を賢く処理するように設計されている必要があります。RACが魔法のように*どんな*アプリケーションも特別な配慮なしにアクティブ-アクティブにすると思い込んでいる人を見かけますが、これはよくある誤解です。
*   **複雑さは現実のもの：** RACには共有ストレージインフラ（多くの場合SAN）、ノード間通信のための高速プライベートインターコネクト（「キャッシュフュージョン」という魔法がここで起こります）、Oracle Gridインフラストラクチャ（Clusterware）が含まれます。これらのコンポーネントは適切に設計、構成、管理される必要があります。これは「設定したら忘れる」ようなソリューションではありません。例えば、プライベートインターコネクトは神経系のようなものです。それが堅牢で低遅延でなければ、RACのパフォーマンスは低下します。
*   **ライセンスコスト：** 率直に言って、Oracle RACは安くありません。エンタープライズエディションとRACオプションが必要です。これは多くの企業にとって重要な要素であり、飛び込む前に、*真の*HA要件とスケーラビリティのニーズ（RPO/RTOに裏付けられた）を理解することが重要である理由です。
*   **RACが適切なのはいつか？** インスタンスレベルのHAが最も重要なミッションクリティカルなデータベース、コンピューティング能力をスケールアウトする必要があると予想される場合、またはパッチ適用のための計画的ダウンタイムの最小化が不可欠な場合です。主な懸念がサイトレベルの災害復旧である場合、RAC単独では答えにはなりません - さらに検討する必要があります。

## 単一データセンターを超えて：Oracle Data Guard – 災害時のライフライン

RACがデータセンター*内*の障害（サーバーの故障など）から保護する一方、火災、洪水、または大規模な停電によってデータセンター全体がオフラインになった場合はどうなりますか？ここで**Oracle Data Guard**が登場します。

Data Guardは、本番用データベースの1つ以上のスタンバイ（バックアップ）コピーを作成し、維持します。これらのスタンバイデータベースは、同じデータセンター内（ストレージ障害からの迅速なローカルリカバリのため、純粋なDRではあまり一般的ではありません）または、より一般的には地理的に離れたデータセンターに配置できます。

### Data Guardがどのように魔法をかけるか：

1.  **ログ配送と適用：** 再実行（Redo）データ（プライマリデータベースに加えられたすべての変更の記録）がプライマリデータベースからスタンバイデータベースに継続的に送信されます。スタンバイデータベースは、この再実行データを適用して同期状態を維持します。
2.  **保護モード：** Data Guardは、データ保護とパフォーマンスのバランスを取るための異なる保護モードを提供します：
    *   **最大パフォーマンス（デフォルト）：** 非同期配送。最高のプライマリデータベースパフォーマンスを提供しますが、すべての再実行データが送信される前にプライマリが失敗した場合、データ損失の小さなリスクがあります。これは多くの場合、最も実用的な選択肢です。
    *   **最大可用性：** 同期配送（主に）。プライマリパフォーマンスよりもデータ保護を優先し、可能であればゼロデータ損失を目指しますが、スタンバイへのネットワークが遅い場合、プライマリパフォーマンスに影響を与える可能性があります。
    *   **最大保護：** 同期配送で、プライマリデータベースは少なくとも1つの同期されたスタンバイに再実行データを書き込めない場合に停止します。ゼロデータ損失を保証しますが、スタンバイリンクが失敗した場合、最も高いパフォーマンスへの影響とプライマリ障害のリスクがあります。私たちは、厳格な要件のため、このモードがあまり使用されないことを見ています。
3.  **ロール移行：**
    *   **スイッチオーバー：** 計画されたロールの反転。プライマリがスタンバイになり、スタンバイが新しいプライマリになります。プライマリサイトの計画的なメンテナンスに使用されます。
    *   **フェイルオーバー：** プライマリデータベースが利用できない場合に開始される計画されていない移行。スタンバイが有効化され、新しいプライマリになります。これがDRの発動です。

### 私たちの「現場からの」Data Guard評価：

*   **RPO/RTOがモード選択を左右する：** あなたのビジネスのデータ損失（RPO）とダウンタイム（RTO）に対する許容度は、どのData Guard保護モードと構成を選択するかに大きく影響します。「ただなんとなく」という理由で最大保護を選ばないでください - その影響を理解しましょう。
*   **Active Data Guard (ADG)はゲームチェンジャー：** このエンタープライズエディションオプションにより、物理スタンバイデータベースは再実行データが適用されている*間*に読み取り専用アクセスのために開かれることができます。これは非常に重要です。レポート、バックアップ、クエリをスタンバイにオフロードして、プライマリの負荷を軽減し、DR投資をより有効に活用できます。可能な限りADGを強くお勧めします。
*   **フェイルオーバーを定期的にテストしてください！** これは強調しすぎることはありません。テストされていないDR計画は単なる紙切れです。定期的にスケジュールされたDR訓練は譲れません。実際の災害が発生する前に、ネットワーク、ストレージ、アプリケーション切り替え手順、および人的エラーの問題を明らかにします。私たちは、厳格なテストを通じて、クライアントが「機能すると思う」から「機能することを*知っている*」に移行するのを支援してきました。
*   **ネットワークが鍵：** プライマリサイトとスタンバイサイト間のネットワークリンクの品質と帯域幅は、特に同期モードや再実行生成率が高い場合に重要です。再実行適用の遅延はRPOを危険にさらす可能性があります。
*   **「Far Sync」インスタンス：** ゼロデータ損失（最大可用性のような）を望むが、DRサイトが同期レプリケーションが効率的に機能するには遠すぎる場合、OracleはFar Syncインスタンスを提供しています。これらの軽量インスタンスはプライマリにより近く配置され、再実行データを同期的に受け取り、その後リモートスタンバイに非同期で転送します。これはギャップを埋める賢い方法です。

## 最高峰：Oracle Maximum Availability Architecture (MAA) – 総合的な設計図

私たちはローカルHAのためのRACとDRのためのData Guardを持っています。しかし、これらはどのように組み合わさるのでしょうか？また、バックアップ、データ破損保護、アプリケーション統合などの他の重要な側面はどうでしょうか？ここで**Oracle Maximum Availability Architecture (MAA)**の出番です。

MAAは購入する単一の製品ではありません。これは、最適な高可用性、データ保護、および災害復旧を達成するためのOracleの**ベストプラクティス設計図**です。Oracleのテクノロジー、機能、および運用プラクティスの組み合わせを活用します。

### MAAの主要原則：

*   **あらゆるレベルでの冗長性：** サーバー、ストレージ、ネットワーク、データベースインスタンス。
*   **単一障害点なし：** 中核的な原則。
*   **データ保護：** 様々なメカニズムによるデータ損失の防止。
*   **迅速な回復：** RTOの最小化。
*   **検出と修復：** 積極的な監視と問題の迅速な解決。

MAAは通常、ローカルHAのためにプライマリサイトにRACを配置し、そのRACデータベースをData Guardを使用してDRサイトのスタンバイRACデータベースにレプリケートすることを含みます。これにより、各サイト内でのインスタンスフェイルオーバーとサイト間でのサイトフェイルオーバーが可能になります。

### 私たちの「現場からの」MAA評価：

*   **段階的なアプローチ：** Oracleは異なるMAAティア（ブロンズ、シルバー、ゴールド、プラチナ）を定義しており、可用性とデータ保護のレベルが段階的に上がります。初日から「完全なプラチナ」にする必要はありません。目標は、ビジネス要件と予算に合ったティアを選ぶことです。
*   **RACとData Guard以上：** MAAはまた以下のことも強調しています：
    *   **フラッシュバック技術：** 完全な復元なしに論理的エラー（例えば、誤った`DROP TABLE`）を素早く元に戻すため。非常に強力です。
    *   **RMAN（Recovery Manager）：** 堅牢なバックアップと復旧戦略のため。
    *   **ASM（Automatic Storage Management）：** 単純化された弾力性のあるストレージ管理のため。
    *   **Oracle GoldenGate（オプションだが強力）：** ゼロダウンタイム移行、アップグレード、またはサイト間のアクティブ-アクティブレプリケーションなどのより複雑なシナリオのため（これには独自の複雑さがあり、単純なMAAのチェックボックスではありません）。
*   **人的要素が重要：** MAAは技術だけではありません。これらの相互接続されたシステムを理解し、DR訓練を効果的に実行し、複雑な問題をトラブルシューティングできる熟練したDBAが必要です。チームのスキルへの投資は、ソフトウェアへの投資と同じくらい重要です。
*   **強固な基盤から始める：** 最初はより単純なHAセットアップを目指していても、MAA原則を念頭に置いて設計することで、後で進化させ、より多くの保護層を追加することが容易になります。私たちは常に将来を見据えて構築しようとしています。

## 私たちの指針となる哲学：HAはパートナーシップであり、製品ではない

過去15年間で、私たちの最大の教訓はこれです：真の堅牢なOracle高可用性を達成することは、問題に対して盲目的に技術を投入することではありません。それはあなたのビジネスについての深い対話から始まります – 何が絶対に*稼働し続けなければならない*のか、どのデータを失うことができないのか、そして何かがうまくいかなくなった場合（そうなる「とき」であって「もし」ではありません）にどれだけ迅速に回復する必要があるかについてです。

私たちの本来の意図と原動力は常に、単にHA「ソリューション」を販売するだけでなく、クライアントのビジネス継続性の旅における真のパートナーになることでした。私たちが学んだことは：

*   **単純さはしばしば過小評価されている：** 時には、適切に構成された単一インスタンスデータベースと堅固なData Guardスタンバイ、そして厳密にテストされた回復手順の方が、完全に理解されていなかったり適切に管理されていない過度に複雑なRAC設定よりも信頼性が高くコスト効率的な場合があります。
*   **テストが全て：** 以前にも言いましたが、もう一度言います。バックアップをテストしてください。フェイルオーバーをテストしてください。フェイルオーバー中のアプリケーションの動作をテストしてください。テストしなければ、わかりません。
*   **文書化は重要：** HA/DR手順のための明確で簡潔、そして*最新の*文書化は重要です。特に実際の障害発生時にプレッシャーを受けている場合はなおさらです。
*   **それは継続的なプロセス：** ビジネスニーズは変化し、技術は進化します。HAの戦略は静的であるべきではありません。定期的なレビューと改良が不可欠です。

## 要塞を構築する準備はできていますか？

Oracle HAの世界を航海することは困難に感じるかもしれませんが、そうである必要はありません。これらの技術は強力であり、思慮深く実装されると、素晴らしい安心感をもたらします。

高可用性について考え始めたばかりであろうと、ヘルスチェックやアップグレードが必要な既存のセットアップがあろうと、私たちは経験を共有する準備ができています。私たちは、技術的に優れているだけでなく、あなたのユニークなビジネスの現実に完全に合致したソリューションを構築することを信じています。なぜなら、最終的に私たちの成功はあなたの中断のない成功によって測られるからです。

あなたの特定のOracle高可用性の課題についてもっと話し合いたい場合は、[お問い合わせください](https://goodwaysit.github.io/ja/contact/)。一緒に弾力性のあるものを構築しましょう。